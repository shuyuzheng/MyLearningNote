* Why should we learn database languages?
    1. we might occasionally get direct access to a database and should be able to cope with it.
    2. we can use databases as a tool for storing and managing data.
* What can we do using database?
    1. Achieve data that needs to be presented or made accessible on a website.
    2. Allow several users access the data at the same time.
    3. Defining different users with different rights.
    4. Databases can be **distributed** across **multiple** disks or several machines altogether.
    5. Databases allows **retrieving** and **subsetting** data with complex data structures.
    6. Querying database is fast.
    7. Allows the definition of **virtual tables** to have data always up to date, organized in a specific way without using much disk space.
    8. You can define specific rules for extending or updating your database.

# 1. Overview and terminology
* **Data** are basically a collection of information such as numbers, logical values, text, or some other format.

* **Database** is simply a collection of data.
    * **Relational database**: The data are related to each other.

* **Database management system(DBMS)**: is an implementation of specific database concept bundled together with software. The software is responsible for:
    * managing the **user rights** and **access**.
    * the way data and meta information are stored physically.
    * how SQL statements are interpreted and executed. 

* **Relational database management systems(RDBMS)**: They are special type of DBMS based on the **relational model**.
    * Popular DBMS: Oracle, MySQL, Microsoft SQL server, PostgreSQL, DB2, Microsoft Access, Sybase, SQLite, Teradata, and File-Maker.

* **SQL**: is a **language** to communicate with relational database management systems.

* **query**: is strictly speaking a request sent to a DBMS to retrieve data. In a broader and more frequently used sense it refers to _any request_ made to a DBMS.

# 2. Relational Database
## 2.1 Storing data in tables

* The main concept of relational database: any kind of information can be represented in a **table**

* **keys**: The unique identifier in each table for entities identification and the combination of information from different tables.
    * **primary keys**: are keys that **unambiguously** identify each row in a table.
    * **foreign keys**: are keys that unambiguously identify rows in **another table**.
    * **Combined keys**: A key can span across several columns as long as the **value combinations** fulfill the requirements for primary or foreign keys.

## 2.2 Normalization

* **Normalization**: is the process of getting rid of **redundancies** and possible **inconsistencies**. (any given piece of information is stored **only once** in a database.)
* **normal forms**: the methods to decomposing data stored in tables. There are several normal forms for database construction, The first three normal forms:
    1. First normal forms:
        1. One column shall refer to **one thing** and to one thing **only** and any **column row intersection** should contain **only one piece** of data. 
        2. Each table shall have a primary key.
    2. Second normal forms:
        1. All requirements for the first normal form shall be met.
        2. Each column of a table shall relate to the complete primary key. (all data in a table describe one thing only)
    3. Third normal form
        1. All requirements for the second normal form shall be met.
        2. Each column of a table shall relate **only** and **directly** to the primary key.
* The benefit for normalization:
    * The higher the **complexity** of the data.
    * The higher the **number** of different purposes a database might serve.
    * the higher the **probability** that information might be **added** in the future.
    * the greater **effort** that should be put into **planning** and rigorously designing the database structure.

## 2.3 advanced features of relational databases and DBMS

* The **data type** definition tells the DBMS how to handle and store the data. It affects the required **disk space** and also impacts **efficiency**. Different DBMS have the handles the data types in the different ways, manual section ot DBMS is a good source for learning about that.

* **Constraining data** enables the user to define under which circumstances data should be accepted and in which cases the DBMS should reject to store the data. There are two ways to constrain data:
    * Specifying columns as primary and foreign keys
    * Explicitly specifying which values or value ranges are valid and which are not.

* **Transaction** bundles multiple steps into a **single**, **all-or-nothing** operation. The intermediate states between the steps are not visible to other concurrent transactions, and if same failure occurs that prevents the transaction from **completing**, then **none** of the steps affect the database at all.

* **User management**: manage the user access right, user name and password.

* **Multi-user access**: handle accesses of more than one user to the same database at the same time.

* **view**: define virtual tables (**view**) to make query easy and intuitive.

* **Functions**: for data manipulation and aggregation.

* **Procedures and triggers**: **procedures** are stored sequences of queries that can be recalled whenever needed. **triggers** are procedures that are executed automatically when certain events take place.

# 3. SQL: a language to communicate with Databases
## 3.1 General remarks on SQL, syntax
* SQL is a multipurpose language:
    * **DCL(data control language)**: define the user rights

    * **DDL(data definition language)**: defines the structure of the data and its relations.

    * **DML(data manipulation language)**: control the data uploading and retrieving.

    * **TCL(transaction control language)**: commit or rollback previous queries.
* The general syntax of SQL:
    1. start with a **command** describing which action should be executed: _CREATE_, _SELECT_, _UPDATE_, or _INSERT INTO_
    2. the **unit** on which it should be executed: `FROM table1`...
    3. one or more **clauses**: `WHERE column1 = 1`
    4. each statement ends with a **semicolon**.
* SQL is **case insensitive** towards its key words. But the DBMS might be **case sensitive** to _table_ and _column_ names.

## Syntax of SQL:
* **Skeleton**: PROCESS _object_ WHERE _location_ 

### 1. Data control language (DCL)

1. `CREATE DATABASE databasename;`: create database.
2. `CREATE USER 'username' IDENTIFIED BY 'password' ;`: create user and password.
3. `DROP USER 'username'`: delete user.
4. `GRANT OPERATION ON database.table TO 'username'`: granting privileges to user. 
    * `database` and `table` can be replaced by `*` to indicate _all databases_ or _all tables_.
    * `OPERATION`:
        * could be specified such as `SELECT` means privileges of _select_.
        * `ALL` means _all_ privileges. 
        * Multiple operations can be specified at the same time but separated by `,`, such as `SELECT, INSERT`.
5. `REVOKE ALL ON database.table TO 'username'`: remove privileges from user.

### Data definition language (DDL)

1. Create tables:
    ```
    CREATE TABLE tablename(
        nameid INTEGER NOT NULL AUTO_INCREMENT ,
        variable1 VARCHAR(100) NOT NULL ,
        variable2 DATE , 
        PRIMARY KEY (nameid)
    ) ;
    ```
    * Data types:
        * `VARCHAR(100)`: 100 characters
        * `INT`: integer
        * `float`: float number
        * `DATE`: date time
    * Attribute of variables:
        * `AUTO_INCREMENT`: automated increasing as new records added in database.
        * `NOT NULL`: constrain that the entries can not be NULL in this variable.
    * Define key variables:
        * `PRIMARY KEY (variable)`: specify this variable as primary key. One table has **one and only one** primary key.
        * `FOREIGN KEY (variables) REFERENCES othertable (otherprimarykey) ON UPDATE CASCADE`: declare **foreign keys** which is the primary key in other tables to generate the relationships between tables.

2. Change table:
    * `ALTER TABLE tablename` followed by:
        * `ADD COLUMN colname DATATYPE`: add columns.
        * `MODIFY COLUMN colname DATATYPE`: modify columns' data type.
        * `DROP COLUMN colname`: delete columns.
    * `DROP TABLE tablename`: delete table.

### Data manipulation language (DML)

1. Fill the table with columns and values:

    ```
    INSERT INTO table (column1, column2, column3) ;
    VALUES ('R1C1', 'R1C2', 'R1C3'),
           ('R2C1', 'R2C2', 'R2C3') ;
    ```

2. `UPDATE table SET updatedcolumn=value WHERE condition ;`: Update columns of table with some _conditions_

3. `DELETE FROM table WHERE condition ;`: Delete rows of table with some _conditions

4. `SELECT columns FROM table ;`: select columns (fields) from table.
    * `*` could be used to indicate _all columns_.
    * Multiple columns can be selected at once by combine with `,`: `SELECT column1, column2 FROM table ;`.

5. `table1 XX JOIN table2 ON id1=id2`: merge tables by ids. (the same as `join` in `dplyr`):
    * `INNER JOIN`: rows in **both** table;
    * `LEFT JOIN`: rows in **left** table;
    * `RIGHT JOIN`: rows in **right** table;
    * `FULL JOIN`: rows in **on of the** tables.

### Clauses

1. `WHERE colname operator value`: restricts data manipulations and retrievals to **specific rows**.
    * `operatior`: `<`, `>`, `=`, `<=`, `>=`, `!=`, `AND`, `ALL`, `LIKE` (matching of text patterns), `IN` (specify a set of acceptable values).

2. `ORDER BY column1 DESC, column2 ASC ;`: sort rows by _column1_ in descending order and _column2_ in ascending order.

3. `COUNT(column)`: count number of entries in _column_.

4. `GROUP BY column ;`: divide rows into several groups according to value of _column_.
    * `GROUP BY column HAVING condition ;`: group by _column_ and filter groups by _condition_.
    

## Transaction control language (TCL)

1. `START TRANSACTION ;`: create a _save point_ to perform _temporary_ changes to database.

2. `COMMIT`: commit changes as _permanent_ to database.

3. `ROLLBACK`: return to the state of _last save point_.

